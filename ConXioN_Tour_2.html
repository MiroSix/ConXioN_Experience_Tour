<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CyberSec Quest</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg: #050d14;
  --neon: #00ffe7;
  --neon2: #ff2d78;
  --neon3: #ffe600;
  --dim: #0a1a28;
  --panel: rgba(0,255,231,0.06);
  --border: rgba(0,255,231,0.25);
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: var(--bg);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  font-family: 'Share Tech Mono', monospace;
  color: var(--neon);
  overflow: hidden;
}

#gameWrapper {
  position: relative;
  width: 900px;
  max-width: 100vw;
}

#header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 4px;
}
#header h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: 20px;
  font-weight: 900;
  letter-spacing: 3px;
  color: var(--neon);
  text-shadow: 0 0 15px var(--neon);
}
#progressBar {
  display: flex;
  gap: 6px;
}
.prog-dot {
  width: 14px; height: 14px;
  border-radius: 50%;
  border: 2px solid var(--neon);
  background: transparent;
  transition: 0.3s;
}
.prog-dot.done {
  background: var(--neon);
  box-shadow: 0 0 8px var(--neon);
}

canvas {
  display: block;
  border: 2px solid var(--border);
  border-radius: 8px;
  box-shadow: 0 0 40px rgba(0,255,231,0.1), inset 0 0 30px rgba(0,0,0,0.5);
  cursor: none;
}

#controls-hint {
  text-align: center;
  font-size: 12px;
  color: rgba(0,255,231,0.45);
  padding: 8px 0 4px;
  letter-spacing: 2px;
}

/* CYBER letter strip */
#cyberStrip {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  padding: 8px 0 6px;
}
#cyberStrip .cyber-letter {
  font-family: 'Orbitron', sans-serif;
  font-size: 28px;
  font-weight: 900;
  width: 44px; height: 44px;
  display: flex; align-items: center; justify-content: center;
  border-radius: 6px;
  border: 2px solid rgba(0,255,231,0.15);
  color: rgba(0,255,231,0.12);
  background: rgba(0,0,0,0.3);
  transition: all 0.5s ease;
  position: relative;
}
#cyberStrip .cyber-letter.unlocked {
  color: var(--neon);
  border-color: var(--neon);
  background: rgba(0,255,231,0.08);
  box-shadow: 0 0 18px rgba(0,255,231,0.5), inset 0 0 10px rgba(0,255,231,0.05);
  text-shadow: 0 0 12px var(--neon);
  animation: letterPop 0.5s ease;
}
@keyframes letterPop {
  0%   { transform: scale(0.6); opacity: 0.3; }
  60%  { transform: scale(1.25); }
  100% { transform: scale(1); opacity: 1; }
}
#cyberStrip .strip-label {
  font-size: 10px;
  letter-spacing: 3px;
  color: rgba(0,255,231,0.35);
  font-family: 'Share Tech Mono', monospace;
  margin: 0 6px;
}

/* Door unlock flash */
@keyframes doorOpen {
  0%   { box-shadow: 0 0 0px transparent; }
  50%  { box-shadow: 0 0 60px rgba(0,255,231,0.9); }
  100% { box-shadow: 0 0 20px rgba(0,255,231,0.4); }
}

/* Modal */
#modal {
  display: none;
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 580px;
  max-width: 96vw;
  background: rgba(5,13,20,0.97);
  border: 2px solid var(--neon);
  border-radius: 16px;
  padding: 36px;
  box-shadow: 0 0 60px rgba(0,255,231,0.25), 0 0 120px rgba(0,255,231,0.1);
  z-index: 100;
  animation: modalIn 0.25s ease;
}
@keyframes modalIn {
  from { transform: translate(-50%, -48%) scale(0.95); opacity:0; }
  to   { transform: translate(-50%, -50%) scale(1);    opacity:1; }
}
#modal .zone-icon {
  font-size: 48px;
  text-align: center;
  margin-bottom: 16px;
}
#modal .zone-label {
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  letter-spacing: 4px;
  color: rgba(0,255,231,0.5);
  text-align: center;
  margin-bottom: 8px;
}
#modal .q-text {
  font-size: 20px;
  line-height: 1.5;
  text-align: center;
  margin-bottom: 28px;
  color: #e8f8ff;
}
.modal-answers {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.modal-answer {
  padding: 16px 20px;
  border: 2px solid rgba(0,255,231,0.2);
  border-radius: 10px;
  font-family: 'Share Tech Mono', monospace;
  font-size: 16px;
  background: rgba(0,255,231,0.04);
  color: #cce8f0;
  cursor: pointer;
  transition: 0.15s;
  text-align: left;
}
.modal-answer:hover {
  border-color: var(--neon);
  background: rgba(0,255,231,0.1);
  color: var(--neon);
  transform: translateX(4px);
}
.modal-answer.selected-ans {
  border-color: var(--neon);
  background: rgba(0,255,231,0.1);
  color: var(--neon);
}
#modal-feedback {
  margin-top: 18px;
  text-align: center;
  font-size: 14px;
  min-height: 20px;
  letter-spacing: 1px;
}
#modal-continue {
  display: none;
  margin: 20px auto 0;
  padding: 12px 30px;
  background: var(--neon);
  color: #020d14;
  border: none;
  border-radius: 8px;
  font-family: 'Orbitron', sans-serif;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  letter-spacing: 2px;
}
#modal-continue:hover { filter: brightness(1.15); }

/* Result screen */
#resultScreen {
  display: none;
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 700px;
  max-width: 96vw;
  background: rgba(5,13,20,0.98);
  border: 2px solid var(--neon);
  border-radius: 16px;
  padding: 48px 40px;
  text-align: center;
  z-index: 200;
  box-shadow: 0 0 80px rgba(0,255,231,0.2);
  animation: modalIn 0.4s ease;
}
#resultScreen h2 {
  font-family: 'Orbitron', sans-serif;
  font-size: 28px;
  margin-bottom: 8px;
  text-shadow: 0 0 20px var(--neon);
}
#resultScreen .subtitle {
  color: rgba(0,255,231,0.5);
  font-size: 12px;
  letter-spacing: 4px;
  margin-bottom: 32px;
}
#scorePercent {
  font-family: 'Orbitron', sans-serif;
  font-size: 72px;
  font-weight: 900;
  line-height: 1;
  margin-bottom: 8px;
}
#scoreSub {
  font-size: 13px;
  color: rgba(0,255,231,0.5);
  margin-bottom: 40px;
}

.levels-grid {
  display: flex;
  gap: 12px;
  margin-bottom: 36px;
}
.level-card {
  flex: 1;
  padding: 16px 10px;
  border: 2px solid rgba(255,255,255,0.08);
  border-radius: 10px;
  transition: 0.3s;
}
.level-card.active {
  border-color: var(--neon);
  box-shadow: 0 0 20px rgba(0,255,231,0.3);
  background: rgba(0,255,231,0.06);
}
.level-card .lv-num {
  font-family: 'Orbitron', sans-serif;
  font-size: 22px;
  font-weight: 900;
  margin-bottom: 4px;
}
.level-card .lv-name {
  font-size: 12px;
  font-weight: 700;
  margin-bottom: 6px;
  font-family: 'Orbitron', sans-serif;
  letter-spacing: 1px;
}
.level-card .lv-desc {
  font-size: 11px;
  color: rgba(200,230,240,0.5);
  line-height: 1.4;
}
.level-card.l1.active { border-color: #ef4444; box-shadow: 0 0 20px rgba(239,68,68,0.3); background: rgba(239,68,68,0.06); }
.level-card.l1.active .lv-num { color: #ef4444; }
.level-card.l2.active { border-color: #f59e0b; box-shadow: 0 0 20px rgba(245,158,11,0.3); background: rgba(245,158,11,0.06); }
.level-card.l2.active .lv-num { color: #f59e0b; }
.level-card.l3.active { border-color: #10b981; box-shadow: 0 0 20px rgba(16,185,129,0.3); background: rgba(16,185,129,0.06); }
.level-card.l3.active .lv-num { color: #10b981; }
.level-card.l4.active { border-color: #22c55e; box-shadow: 0 0 20px rgba(34,197,94,0.35); background: rgba(34,197,94,0.06); }
.level-card.l4.active .lv-num { color: #22c55e; }

#playAgain {
  padding: 14px 40px;
  background: transparent;
  color: var(--neon);
  border: 2px solid var(--neon);
  border-radius: 10px;
  font-family: 'Orbitron', sans-serif;
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 3px;
  cursor: pointer;
  transition: 0.2s;
}
#playAgain:hover {
  background: var(--neon);
  color: #020d14;
  box-shadow: 0 0 20px rgba(0,255,231,0.4);
}

/* Scanline overlay */
#gameWrapper::after {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.06) 2px, rgba(0,0,0,0.06) 4px);
  z-index: 50;
  border-radius: 8px;
}
</style>
</head>
<body>

<div id="gameWrapper">
  <div id="header">
    <h1>â¬¡ CYBERSEC QUEST</h1>
    <div id="progressBar"></div>
  </div>
  <div id="cyberStrip">
    <span class="strip-label">LETTERS:</span>
    <div class="cyber-letter" id="cs-0">?</div>
    <div class="cyber-letter" id="cs-1">?</div>
    <div class="cyber-letter" id="cs-2">?</div>
    <div class="cyber-letter" id="cs-3">?</div>
    <div class="cyber-letter" id="cs-4">?</div>
  </div>
  <canvas id="gameCanvas" width="900" height="560"></canvas>
  <div id="controls-hint">WASD / ARROW KEYS â€” MOVE &nbsp;|&nbsp; [E] / [SPACE] â€” INTERACT</div>

  <!-- Quiz modal -->
  <div id="modal">
    <div class="zone-icon" id="modal-icon"></div>
    <div class="zone-label" id="modal-label"></div>
    <div class="q-text" id="modal-q"></div>
    <div class="modal-answers" id="modal-answers"></div>
    <div id="modal-feedback"></div>
    <button id="modal-continue">DOORGAAN â†’</button>
  </div>

  <!-- Door codeword modal -->
  <div id="doorModal" style="display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:480px; max-width:96vw; background:rgba(5,13,20,0.98); border:2px solid var(--neon); border-radius:16px; padding:40px 36px; box-shadow:0 0 80px rgba(0,255,231,0.3); z-index:100; text-align:center; animation:modalIn 0.25s ease;">
    <div style="font-size:48px; margin-bottom:16px;">ğŸšª</div>
    <div style="font-family:'Orbitron',sans-serif; font-size:11px; letter-spacing:4px; color:rgba(0,255,231,0.5); margin-bottom:12px;">BEVEILIGDE DEUR</div>
    <div style="font-size:17px; color:#e8f8ff; line-height:1.6; margin-bottom:28px;">Je hebt letters vrijgespeeld.<br>Ontcijfer het codewoord en typ het in om de deur te openen.</div>
    <input id="codeInput" type="text" maxlength="10" placeholder="CODEWOORD..."
      style="width:100%; padding:14px 18px; background:rgba(0,255,231,0.06); border:2px solid rgba(0,255,231,0.3); border-radius:10px; color:var(--neon); font-family:'Orbitron',sans-serif; font-size:22px; letter-spacing:6px; text-align:center; outline:none; text-transform:uppercase; margin-bottom:12px;"
    />
    <div id="doorFeedback" style="min-height:20px; font-size:13px; margin-bottom:16px; letter-spacing:1px;"></div>
    <div style="display:flex; gap:12px; justify-content:center;">
      <button id="doorCancel" style="padding:12px 24px; background:transparent; color:rgba(0,255,231,0.5); border:2px solid rgba(0,255,231,0.2); border-radius:8px; font-family:'Orbitron',sans-serif; font-size:13px; cursor:pointer; letter-spacing:2px;">ANNULEER</button>
      <button id="doorSubmit" style="padding:12px 28px; background:var(--neon); color:#020d14; border:none; border-radius:8px; font-family:'Orbitron',sans-serif; font-size:13px; font-weight:700; cursor:pointer; letter-spacing:2px;">BEVESTIG</button>
    </div>
  </div>
  <div id="resultScreen">
    <h2>MISSION COMPLETE</h2>
    <div class="subtitle">CYBERSECURITY MATURITEIT RAPPORT</div>
    <div id="scorePercent"></div>
    <div id="scoreSub"></div>
    <div class="levels-grid">
      <div class="level-card l1" id="res-l1">
        <div class="lv-num">1</div>
        <div class="lv-name">Kwetsbaar</div>
        <div class="lv-desc">Weinig beveiligingsmaatregelen actief</div>
      </div>
      <div class="level-card l2" id="res-l2">
        <div class="lv-num">2</div>
        <div class="lv-name">Bewust</div>
        <div class="lv-desc">Basiskennis aanwezig, nog verbeterpunten</div>
      </div>
      <div class="level-card l3" id="res-l3">
        <div class="lv-num">3</div>
        <div class="lv-name">Weerbaar</div>
        <div class="lv-desc">Goede cyberhygiÃ«ne en alertheid</div>
      </div>
      <div class="level-card l4" id="res-l4">
        <div class="lv-num">4</div>
        <div class="lv-name">Cyberproof</div>
        <div class="lv-desc">Sterke digitale weerbaarheid</div>
      </div>
    </div>
    <button id="playAgain">OPNIEUW SPELEN</button>
  </div>
</div>

<script>
// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const questions = [
  {
    id: 0,
    label: "WACHTWOORD BEHEER",
    icon: "ğŸ”‘",
    text: "Gebruik je unieke wachtwoorden voor al je belangrijke accounts?",
    answers: ["Ja, elk account heeft een uniek wachtwoord", "Soms, voor een paar accounts", "Nee, ik hergebruik wachtwoorden"],
    scores: [2, 1, 0]
  },
  {
    id: 1,
    label: "TWEE-FACTOR AUTHENTICATIE",
    icon: "ğŸ“±",
    text: "Schakel je twee-factor authenticatie (2FA) in waar dit mogelijk is?",
    answers: ["Ja, altijd als het kan", "Op sommige accounts", "Nee, ik gebruik geen 2FA"],
    scores: [2, 1, 0]
  },
  {
    id: 2,
    label: "SOFTWARE UPDATES",
    icon: "âš™ï¸",
    text: "Installeer je beveiligingsupdates zodra ze beschikbaar zijn?",
    answers: ["Ja, meteen installeren", "Soms, maar niet altijd", "Nee, ik stel updates uit of negeer ze"],
    scores: [2, 1, 0]
  },
  {
    id: 3,
    label: "PHISHING DETECTIE",
    icon: "ğŸ“§",
    text: "Controleer je de afzender en links bij verdachte e-mails?",
    answers: ["Ja, altijd zorgvuldig", "Soms, als het verdacht lijkt", "Nee, ik klik zonder te controleren"],
    scores: [2, 1, 0]
  },
  {
    id: 4,
    label: "DE KLUIS",
    icon: "ğŸ”",
    text: "Heb je MFA aanstaan waar mogelijk?",
    answers: ["Ja, op alles", "Alleen op belangrijke accounts", "Enkel als het verplicht is","Ik weet niet wat MFA is.","Nee"],
    scores: [3, 2, 1, 0 ,0]
  },
  {
    id: 5,
    label: "SOFTWARE BRONNEN",
    icon: "ğŸ›’",
    text: "Download je software uitsluitend van officiÃ«le en betrouwbare bronnen?",
    answers: ["Ja, altijd van officiÃ«le bronnen", "Meestal wel, soms elders", "Nee, ik download overal vandaan"],
    scores: [2, 1, 0]
  },
  {
    id: 6,
    label: "ANTIVIRUS BESCHERMING",
    icon: "ğŸ›¡ï¸",
    text: "Gebruik je actieve antivirussoftware of ingebouwde beveiligingstools?",
    answers: ["Ja, actief en up-to-date", "Ik heb iets maar weet niet of het actief is", "Nee, ik gebruik geen antivirus"],
    scores: [2, 1, 0]
  },
  {
    id: 7,
    label: "POSTKANTOOR",
    icon: "ğŸ“©",
    text: "Hoe controleer je of een mail phishing is?",
    answers: ["Ik kijk alleen naar de naam", "Ik controleer het volledige e-mailadres", "Ik doe dit niet"],
    scores: [1, 2, 0]
  }
];

// â”€â”€â”€ ZONE POSITIONS (placed as objects in the room) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Zones are distributed around the room. Each zone is a clickable terminal/object.
const ZONES = [
  { id: 0, x: 90,  y: 75,  w: 80, h: 70, color: '#00ffe7', label: 'PASSWORD', symbol: 'ğŸ”‘' },
  { id: 1, x: 390, y: 65,  w: 80, h: 70, color: '#a78bfa', label: '2FA',      symbol: 'ğŸ“±' },
  { id: 2, x: 700, y: 75,  w: 80, h: 70, color: '#fb923c', label: 'UPDATES',  symbol: 'âš™ï¸' },
  { id: 3, x: 755, y: 290, w: 80, h: 70, color: '#f472b6', label: 'EMAIL',    symbol: 'ğŸ“§' },
  { id: 4, x: 700, y: 415, w: 80, h: 70, color: '#60a5fa', label: 'DE KLUIS',   symbol: 'ğŸ”' },
  { id: 5, x: 390, y: 420, w: 80, h: 70, color: '#34d399', label: 'DOWNLOAD', symbol: 'ğŸ›’' },
  { id: 6, x: 90,  y: 415, w: 80, h: 70, color: '#fbbf24', label: 'ANTIVIRUS',symbol: 'ğŸ›¡ï¸' },
  { id: 7, x: 60,  y: 275, w: 80, h: 70, color: '#f87171', label: 'POSTKANTOOR',  symbol: 'ğŸ“©' },
];

// â”€â”€â”€ CYBER LETTER MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Which question ID unlocks which letter of CYBER
const LETTER_MAP = { 0: 'C', 2: 'Y', 4: 'B', 6: 'E', 7: 'R' };
let unlockedLetters = {};  // e.g. { C: true, Y: true }
let unlockedOrder = [];    // letters in the order they were unlocked

// â”€â”€â”€ DOOR STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DOOR = { x: 856, y: 205, w: 22, h: 130 };
let doorOpen = false;
let nearDoor = false;
let doorOpenAnim = 0; // animation counter
let player = { x: 430, y: 270, w: 24, h: 30, speed: 3 };
let keys = {};
let answered = new Array(8).fill(false);
let scores = new Array(8).fill(0);
let activeZone = null;
let nearZone = null;
let gameActive = true;
let pulseT = 0;

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// â”€â”€â”€ PROGRESS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const pb = document.getElementById('progressBar');
for (let i = 0; i < 8; i++) {
  const d = document.createElement('div');
  d.className = 'prog-dot';
  d.id = 'dot' + i;
  pb.appendChild(d);
}

function updateDots() {
  for (let i = 0; i < 8; i++) {
    document.getElementById('dot' + i).classList.toggle('done', answered[i]);
  }
}

// â”€â”€â”€ INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown', e => {
  keys[e.key] = true;
  if ((e.key === 'e' || e.key === 'E' || e.key === ' ') && gameActive) {
    if (nearZone !== null && !answered[nearZone]) {
      openModal(nearZone);
    } else if (nearDoor && !doorOpen) {
      openDoor();
    }
    e.preventDefault();
  }
});
document.addEventListener('keyup', e => { keys[e.key] = false; });

// â”€â”€â”€ ROOM GEOMETRY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const WALL = 50; // wall thickness
const CW = 900, CH = 560;

function isColliding(rx, ry, rw, rh) {
  // Outer walls
  if (rx < WALL || ry < WALL || rx + rw > CW - WALL || ry + rh > CH - WALL) return true;
  // Zone objects (solid parts)
  for (const z of ZONES) {
    if (rx < z.x + z.w && rx + rw > z.x && ry < z.y + z.h && ry + rh > z.y) return true;
  }
  return false;
}

// â”€â”€â”€ RENDERING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Floor tile pattern
const offscreen = document.createElement('canvas');
offscreen.width = 40; offscreen.height = 40;
const oCtx = offscreen.getContext('2d');
oCtx.fillStyle = '#071320';
oCtx.fillRect(0, 0, 40, 40);
oCtx.strokeStyle = 'rgba(0,255,231,0.05)';
oCtx.lineWidth = 1;
oCtx.strokeRect(0, 0, 40, 40);
const floorPattern = ctx.createPattern(offscreen, 'repeat');

function drawRoom() {
  // Background
  ctx.fillStyle = '#050d14';
  ctx.fillRect(0, 0, CW, CH);

  // Floor
  ctx.save();
  ctx.translate(WALL, WALL);
  ctx.fillStyle = floorPattern;
  ctx.fillRect(0, 0, CW - WALL*2, CH - WALL*2);
  ctx.restore();

  // Walls (dark panels with neon border)
  ctx.fillStyle = '#0a1825';
  // top wall
  ctx.fillRect(0, 0, CW, WALL);
  ctx.fillRect(0, CH - WALL, CW, WALL);
  ctx.fillRect(0, 0, WALL, CH);
  ctx.fillRect(CW - WALL, 0, WALL, CH);

  // Neon wall trim
  ctx.strokeStyle = 'rgba(0,255,231,0.35)';
  ctx.lineWidth = 2;
  ctx.strokeRect(WALL, WALL, CW - WALL*2, CH - WALL*2);

  // Corner decorations
  const corners = [[WALL,WALL],[CW-WALL,WALL],[WALL,CH-WALL],[CW-WALL,CH-WALL]];
  corners.forEach(([cx,cy]) => {
    ctx.strokeStyle = 'rgba(0,255,231,0.6)';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(cx - 14, cy); ctx.lineTo(cx, cy); ctx.lineTo(cx, cy - 14);
    ctx.moveTo(cx + 14, cy); ctx.lineTo(cx, cy); ctx.lineTo(cx, cy + 14);
    ctx.stroke();
  });
}

function drawZone(z) {
  const answered_z = answered[z.id];
  const isNear = nearZone === z.id;
  const pulse = Math.sin(pulseT * 0.05) * 0.5 + 0.5;

  ctx.save();

  // Glow background
  const glowAlpha = answered_z ? 0.08 : (isNear ? 0.2 + pulse * 0.15 : 0.1 + pulse * 0.05);
  const grad = ctx.createRadialGradient(z.x + z.w/2, z.y + z.h/2, 0, z.x + z.w/2, z.y + z.h/2, 70);
  grad.addColorStop(0, z.color + Math.floor(glowAlpha * 255).toString(16).padStart(2,'0'));
  grad.addColorStop(1, 'transparent');
  ctx.fillStyle = grad;
  ctx.fillRect(z.x - 20, z.y - 20, z.w + 40, z.h + 40);

  // Terminal body
  ctx.fillStyle = answered_z ? '#0a2015' : '#0a1420';
  ctx.strokeStyle = answered_z ? '#00ff88' : (isNear ? z.color : z.color + '66');
  ctx.lineWidth = isNear ? 3 : 2;
  roundRect(ctx, z.x, z.y, z.w, z.h, 8);
  ctx.fill(); ctx.stroke();

  // Screen inside
  const screenColor = answered_z ? '#001a0a' : '#001018';
  ctx.fillStyle = screenColor;
  roundRect(ctx, z.x + 8, z.y + 8, z.w - 16, z.h - 28, 4);
  ctx.fill();

  // Icon / checkmark
  ctx.font = '26px serif';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(answered_z ? 'âœ“' : z.symbol, z.x + z.w/2, z.y + z.h/2 - 4);

  // Label
  ctx.font = '7px "Share Tech Mono"';
  ctx.fillStyle = answered_z ? '#00ff88' : z.color;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'bottom';
  ctx.fillText(z.label, z.x + z.w/2, z.y + z.h - 4);

  // "Press E" prompt
  if (isNear && !answered_z) {
    ctx.font = 'bold 11px "Share Tech Mono"';
    ctx.fillStyle = `rgba(0,255,231,${0.6 + pulse * 0.4})`;
    ctx.textAlign = 'center';
    ctx.fillText('[E] INTERACT', z.x + z.w/2, z.y - 10);
  }

  ctx.restore();
}

function drawPlayer() {
  const px = player.x, py = player.y;
  const pw = player.w, ph = player.h;
  const pulse = Math.sin(pulseT * 0.08) * 0.5 + 0.5;

  // Shadow glow
  const g = ctx.createRadialGradient(px+pw/2, py+ph, 0, px+pw/2, py+ph, 20);
  g.addColorStop(0, 'rgba(0,255,231,0.25)');
  g.addColorStop(1, 'transparent');
  ctx.fillStyle = g;
  ctx.fillRect(px - 10, py, pw + 20, 20);

  // Body
  ctx.fillStyle = '#0d2535';
  ctx.strokeStyle = '#00ffe7';
  ctx.lineWidth = 2;
  roundRect(ctx, px + 4, py + 12, pw - 8, ph - 12, 3);
  ctx.fill(); ctx.stroke();

  // Head
  ctx.fillStyle = '#1a3a4a';
  ctx.strokeStyle = '#00ffe7';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.ellipse(px + pw/2, py + 8, 9, 10, 0, 0, Math.PI * 2);
  ctx.fill(); ctx.stroke();

  // Visor
  ctx.fillStyle = `rgba(0,255,231,${0.4 + pulse * 0.3})`;
  ctx.beginPath();
  ctx.ellipse(px + pw/2, py + 8, 6, 4, 0, 0, Math.PI * 2);
  ctx.fill();

  // Legs
  ctx.strokeStyle = '#00ffe7';
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(px + pw/2 - 4, py + ph);
  ctx.lineTo(px + pw/2 - 4, py + ph + 6);
  ctx.moveTo(px + pw/2 + 4, py + ph);
  ctx.lineTo(px + pw/2 + 4, py + ph + 6);
  ctx.stroke();
}

function roundRect(ctx, x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + w - r, y);
  ctx.quadraticCurveTo(x + w, y, x + w, y + r);
  ctx.lineTo(x + w, y + h - r);
  ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
  ctx.lineTo(x + r, y + h);
  ctx.quadraticCurveTo(x, y + h, x, y + h - r);
  ctx.lineTo(x, y + r);
  ctx.quadraticCurveTo(x, y, x + r, y);
  ctx.closePath();
}

// â”€â”€â”€ GAME LOOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function update() {
  if (!gameActive) return;

  pulseT++;

  let dx = 0, dy = 0;
  if (keys['ArrowLeft']  || keys['a'] || keys['A']) dx -= player.speed;
  if (keys['ArrowRight'] || keys['d'] || keys['D']) dx += player.speed;
  if (keys['ArrowUp']    || keys['w'] || keys['W']) dy -= player.speed;
  if (keys['ArrowDown']  || keys['s'] || keys['S']) dy += player.speed;

  // Diagonal normalization
  if (dx && dy) { dx *= 0.707; dy *= 0.707; }

  // Move X
  const nx = player.x + dx;
  if (!isColliding(nx, player.y, player.w, player.h + 6)) player.x = nx;

  // Move Y
  const ny = player.y + dy;
  if (!isColliding(player.x, ny, player.w, player.h + 6)) player.y = ny;

  // Proximity check for zones
  nearZone = null;
  for (const z of ZONES) {
    if (answered[z.id]) continue;
    const cx = player.x + player.w/2, cy = player.y + player.h/2;
    const zCx = z.x + z.w/2, zCy = z.y + z.h/2;
    const dist = Math.hypot(cx - zCx, cy - zCy);
    if (dist < 70) { nearZone = z.id; break; }
  }

  // Door proximity check
  const px = player.x + player.w/2, py = player.y + player.h/2;
  const allUnlocked = 'CYBER'.split('').every(l => unlockedLetters[l]);
  const allAnswered = answered.every(Boolean);
  nearDoor = !doorOpen && allUnlocked && allAnswered && px > 810 && Math.abs(py - (DOOR.y + DOOR.h/2)) < 90;

  if (doorOpenAnim > 0) doorOpenAnim--;
}

function drawDoor() {
  const pulse = Math.sin(pulseT * 0.05) * 0.5 + 0.5;
  const allUnlocked = 'CYBER'.split('').every(l => unlockedLetters[l]);

  ctx.save();

  if (doorOpen) {
    // Door is open â€” draw open door frame + glow
    const glowA = 0.5 + pulse * 0.2;
    ctx.strokeStyle = `rgba(0,255,231,${glowA})`;
    ctx.lineWidth = 3;
    // Frame only (top + sides)
    ctx.beginPath();
    ctx.moveTo(DOOR.x, DOOR.y + DOOR.h);
    ctx.lineTo(DOOR.x, DOOR.y);
    ctx.lineTo(DOOR.x + DOOR.w, DOOR.y);
    ctx.lineTo(DOOR.x + DOOR.w, DOOR.y + DOOR.h);
    ctx.stroke();
    // Inner passage glow
    const grad = ctx.createLinearGradient(DOOR.x, 0, DOOR.x + DOOR.w + 30, 0);
    grad.addColorStop(0, `rgba(0,255,231,${0.25 * (1 + pulse * 0.3)})`);
    grad.addColorStop(1, 'transparent');
    ctx.fillStyle = grad;
    ctx.fillRect(DOOR.x, DOOR.y, 60, DOOR.h);
    // "VOLGENDE KAMER" text
    ctx.font = 'bold 9px "Share Tech Mono"';
    ctx.fillStyle = `rgba(0,255,231,${0.5 + pulse * 0.3})`;
    ctx.textAlign = 'center';
    ctx.save();
    ctx.translate(DOOR.x + 35, DOOR.y + DOOR.h/2);
    ctx.rotate(Math.PI / 2);
    ctx.fillText('VOLGENDE KAMER â–¶', 0, 0);
    ctx.restore();
  } else {
    // Locked / unlockable door
    const locked = !allUnlocked;
    const borderCol = locked ? 'rgba(255,45,120,0.5)' : `rgba(0,255,231,${0.5 + pulse * 0.4})`;

    // Door body
    ctx.fillStyle = locked ? '#1a0810' : '#001a15';
    ctx.strokeStyle = borderCol;
    ctx.lineWidth = nearDoor ? 3 : 2;
    roundRect(ctx, DOOR.x, DOOR.y, DOOR.w, DOOR.h, 4);
    ctx.fill(); ctx.stroke();

    // Door handle
    ctx.fillStyle = locked ? '#ff2d78' : (nearDoor ? '#00ffe7' : 'rgba(0,255,231,0.4)');
    ctx.beginPath();
    ctx.arc(DOOR.x + 6, DOOR.y + DOOR.h/2, 4, 0, Math.PI * 2);
    ctx.fill();

    // Lock icon
    ctx.font = '14px serif';
    ctx.textAlign = 'center';
    ctx.fillText(locked ? 'ğŸ”’' : 'ğŸ”“', DOOR.x + DOOR.w/2, DOOR.y + DOOR.h/2 - 12);

    // CYBER label
    ctx.font = 'bold 7px "Share Tech Mono"';
    ctx.fillStyle = locked ? 'rgba(255,45,120,0.6)' : `rgba(0,255,231,${0.5 + pulse * 0.4})`;
    ctx.textAlign = 'center';
    ctx.fillText('CYBER', DOOR.x + DOOR.w/2, DOOR.y + DOOR.h - 8);

    // Prompt
    if (nearDoor) {
      ctx.font = 'bold 11px "Share Tech Mono"';
      ctx.fillStyle = `rgba(0,255,231,${0.6 + pulse * 0.4})`;
      ctx.fillText('[E] VOER CODEWOORD IN', DOOR.x - 30, DOOR.y - 10);
    }
  }
  ctx.restore();
}

function render() {
  ctx.clearRect(0, 0, CW, CH);
  drawRoom();
  drawDoor();
  ZONES.forEach(drawZone);
  drawPlayer();
}

function loop() {
  update();
  render();
  requestAnimationFrame(loop);
}

// â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(zoneId) {
  activeZone = zoneId;
  gameActive = false;
  const q = questions[zoneId];

  document.getElementById('modal-icon').textContent = q.icon;
  document.getElementById('modal-label').textContent = q.label;
  document.getElementById('modal-q').textContent = q.text;
  document.getElementById('modal-feedback').textContent = '';
  document.getElementById('modal-continue').style.display = 'none';

  const answersDiv = document.getElementById('modal-answers');
  answersDiv.innerHTML = '';
  q.answers.forEach((ans, i) => {
    const btn = document.createElement('button');
    btn.className = 'modal-answer';
    btn.textContent = ans;
    btn.onclick = () => selectAnswer(i);
    answersDiv.appendChild(btn);
  });

  document.getElementById('modal').style.display = 'block';
}

function selectAnswer(i) {
  const q = questions[activeZone];
  const score = q.scores[i];
  scores[activeZone] = score;
  answered[activeZone] = true;

  const btns = document.querySelectorAll('.modal-answer');
  btns.forEach((b, idx) => {
    b.style.pointerEvents = 'none';
    if (idx === i) b.classList.add('selected-ans');
  });

  // Unlock CYBER letter if this zone is mapped
  const letter = LETTER_MAP[activeZone];
  if (letter) {
    unlockedLetters[letter] = true;
    unlockedOrder.push(letter);
    const slotIdx = unlockedOrder.length - 1;
    const el = document.getElementById('cs-' + slotIdx);
    if (el) {
      el.textContent = letter;
      el.classList.add('unlocked');
    }
  }

  const fb = document.getElementById('modal-feedback');
  fb.textContent = '';

  document.getElementById('modal-continue').style.display = 'block';
  updateDots();

  // Check all done
  if (answered.every(Boolean)) {
    document.getElementById('modal-continue').textContent = 'NAAR DE DEUR â†’';
    document.getElementById('modal-continue').onclick = () => {
      closeModal();
      // Show hint in canvas that they should go to the door
    };
  } else {
    document.getElementById('modal-continue').onclick = closeModal;
  }
}

function closeModal() {
  document.getElementById('modal').style.display = 'none';
  gameActive = true;
}

// â”€â”€â”€ DOOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openDoor() {
  // Show codeword input modal
  gameActive = false;
  document.getElementById('codeInput').value = '';
  document.getElementById('doorFeedback').textContent = '';
  document.getElementById('doorFeedback').style.color = 'var(--neon2)';
  document.getElementById('doorModal').style.display = 'block';
  setTimeout(() => document.getElementById('codeInput').focus(), 100);
}

function tryUnlockDoor() {
  const val = document.getElementById('codeInput').value.trim().toUpperCase();
  if (val === 'CYBER') {
    document.getElementById('doorModal').style.display = 'none';
    doorOpen = true;
    nearDoor = false;
    canvas.style.animation = 'doorOpen 1s ease';
    setTimeout(() => { canvas.style.animation = ''; }, 1000);
    setTimeout(showResults, 800);
  } else {
    document.getElementById('doorFeedback').textContent = 'âœ— INCORRECT CODEWOORD â€” PROBEER OPNIEUW';
    document.getElementById('doorFeedback').style.color = 'var(--neon2)';
    document.getElementById('codeInput').value = '';
    document.getElementById('codeInput').focus();
  }
}

document.getElementById('doorSubmit').onclick = tryUnlockDoor;
document.getElementById('doorCancel').onclick = () => {
  document.getElementById('doorModal').style.display = 'none';
  gameActive = true;
};
document.getElementById('codeInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') tryUnlockDoor();
  e.stopPropagation(); // prevent game keys from firing
});

// â”€â”€â”€ RESULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showResults() {
  document.getElementById('modal').style.display = 'none';
  const total = scores.reduce((a, b) => a + b, 0);
  const max = questions.length * 2;
  const pct = Math.round((total / max) * 100);

  let level;
  if (pct < 40) level = 1;
  else if (pct < 60) level = 2;
  else if (pct < 80) level = 3;
  else level = 4;

  document.getElementById('scorePercent').textContent = pct + '%';
  document.getElementById('scorePercent').style.color =
    level === 1 ? '#ef4444' : level === 2 ? '#f59e0b' : level === 3 ? '#10b981' : '#22c55e';

  const labels = ['', 'Kwetsbaar', 'Bewust', 'Weerbaar', 'Cyberproof'];
  document.getElementById('scoreSub').textContent = `${total} / ${max} punten â€” Niveau ${level}: ${labels[level]}`;

  for (let i = 1; i <= 4; i++) {
    document.getElementById('res-l' + i).classList.toggle('active', i === level);
  }

  document.getElementById('resultScreen').style.display = 'block';
}

document.getElementById('playAgain').onclick = () => {
  answered.fill(false);
  scores.fill(0);
  unlockedLetters = {};
  unlockedOrder = [];
  doorOpen = false;
  nearDoor = false;
  for (let i = 0; i < 5; i++) {
    const el = document.getElementById('cs-' + i);
    if (el) { el.classList.remove('unlocked'); el.textContent = '?'; }
  }
  player.x = 430; player.y = 270;
  activeZone = null; nearZone = null;
  gameActive = true;
  document.getElementById('resultScreen').style.display = 'none';
  updateDots();
};

// â”€â”€â”€ START â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
updateDots();
loop();
</script>
</body>
</html>
